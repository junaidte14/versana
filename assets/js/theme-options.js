/**
 * Versana Admin JavaScript
 *
 * @package Versana
 * @since 1.0.0
 */

(function($) {
    'use strict';
    
    $(document).ready(function() {
        
        /**
         * Initialize WordPress Color Pickers
         */
        if (typeof $.fn.wpColorPicker !== 'undefined') {
            $('.versana-color-picker').wpColorPicker();
        }
        
        /**
         * Reset to Defaults
         */
        $('.versana-reset-options').on('click', function(e) {
            e.preventDefault();
            
            if (!confirm('Are you sure you want to reset all options?')) {
                return;
            }

            var $form = $('#versana-theme-options');
            
            // 1. Inject the reset flag so PHP knows to clear the data
            if ($form.find('input[name="versana_reset_options"]').length === 0) {
                $('<input>').attr({
                    type: 'hidden',
                    name: 'versana_reset_options',
                    value: '1'
                }).appendTo($form);
            }

            // 2. Find the REAL submit button (the one generated by submit_button())
            // and trigger a click on it. This fires all native browser/WP events.
            $form.find('input[type="submit"], #submit').first().trigger('click');
        });
        
        /**
         * Validation for analytics IDs
         */
        $('#google_analytics_id').on('blur', function() {
            var value = $(this).val().trim();
            if (value && !value.match(/^(UA|G)-[0-9]+-[0-9]+$/) && !value.match(/^G-[A-Z0-9]+$/)) {
                alert('Please enter a valid Google Analytics ID (format: G-XXXXXXXXXX or UA-XXXXXX-X)');
            }
        });
        
        /**
         * Tab switching with localStorage
         */
        $('.nav-tab').on('click', function() {
            var tab = $(this).attr('href').split('tab=')[1];
            if (tab) {
                localStorage.setItem('versana_active_tab', tab);
            }
        });
        
        // Restore active tab on page load
        var savedTab = localStorage.getItem('versana_active_tab');
        if (savedTab) {
            var tabUrl = window.location.href.split('&tab=')[0] + '&tab=' + savedTab;
            if (window.location.href.indexOf('tab=') === -1) {
                // Don't auto-navigate on first load
                localStorage.removeItem('versana_active_tab');
            }
        }
        
    });
    
})(jQuery);